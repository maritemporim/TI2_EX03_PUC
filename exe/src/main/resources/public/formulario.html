<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Estoque</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
            background-color: #f4f4f4;
        }
        h1 {
            color: #333;
            font-size: 24px;
            margin-bottom: 20px;
        }
        .secao {
            padding: 20px 0;
        }
        .divisoria {
            border-top: 1px dashed #aaa;
            margin: 20px 0;
        }
        .campo-grupo {
            display: inline-block;
            margin-right: 20px;
            margin-bottom: 10px;
            vertical-align: top;
        }
        .campo-grupo label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 14px;
        }
        .campo-grupo input[type="text"],
        .campo-grupo input[type="number"],
        .campo-grupo input[type="datetime-local"],
        .campo-grupo input[type="date"] {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 150px;
            box-sizing: border-box;
            font-size: 14px;
        }
        #secao-inserir .campo-grupo input[type="text"] {
            width: 200px;
        }
        #secao-acoes .campo-grupo input[type="text"] {
            width: 120px;
        }
        button {
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-right: 10px;
            font-size: 14px;
        }
        .btn-cadastrar { background-color: #4CAF50; }
        .btn-consultar { background-color: #007bff; }
        .btn-remover { background-color: #dc3545; }
        .btn-todos { background-color: #007bff; }
        .titulo-bloco {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
            margin-right: 30px;
            display: inline-block;
        }
        #secao-acoes-container {
            display: flex;
            justify-content: flex-start;
            gap: 50px;
        }
    </style>
</head>
<body>
    <h1>Controle de Estoque</h1>

    <div class="secao" id="secao-inserir">
        <h2>Inserir Produto</h2>
        <form id="form-cadastrar">
            <div class="campo-grupo">
                <label for="descricao">Descrição:</label>
                <input type="text" id="descricao" name="descricao" placeholder="leite, pão..." required>
            </div>
            <div class="campo-grupo">
                <label for="preco">Preço:</label>
                <input type="text" id="preco" name="preco" required>
            </div>
            <div class="campo-grupo">
                <label for="quantidade">Quantidade:</label>
                <input type="number" id="quantidade" name="quantidade" required>
            </div>
            <div class="campo-grupo">
                <label for="dataFabricacao">Data de fabricação:</label>
                <input type="datetime-local" id="dataFabricacao" name="dataFabricacao" required>
            </div>
            <div class="campo-grupo">
                <label for="dataValidade">Data de validade:</label>
                <input type="date" id="dataValidade" name="dataValidade" required>
            </div>
            <br>
            <button type="submit" class="btn-cadastrar">cadastrar</button>
        </form>
    </div>

    <div class="divisoria"></div>

    <div class="secao" id="secao-acoes">
        <div id="secao-acoes-container">
            <div>
                <span class="titulo-bloco">Detalhar produto</span>
                <form id="form-detalhar">
                    <div class="campo-grupo">
                        <input type="text" id="idDetalhar" name="idDetalhar" placeholder="id do produto..." required>
                    </div>
                    <button type="submit" class="btn-consultar">consultar</button>
                </form>
            </div>
            <div>
                <span class="titulo-bloco">Remover produto</span>
                <form id="form-remover">
                    <div class="campo-grupo">
                        <input type="text" id="idRemover" name="idRemover" placeholder="id do produto..." required>
                    </div>
                    <button type="submit" class="btn-remover">remover</button>
                </form>
            </div>
            <div>
                <span class="titulo-bloco">Listar produtos</span>
                <form>
                    <button type="button" id="btn-todos" class="btn-todos">todos</button>
                </form>
            </div>
        </div>
    </div>

    <div class="divisoria"></div>

    <script>
        // CORREÇÃO APLICADA AQUI: Envia como form-urlencoded, compatível com request.queryParams
        document.getElementById('form-cadastrar').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            // 1. Coleta todos os dados do formulário
            const formData = new FormData(this);
            
            // 2. Converte para uma query string (chave=valor&chave2=valor2)
            const params = new URLSearchParams(formData).toString();

            // 3. Envia a requisição POST com os dados na URL
            const res = await fetch('/produto?' + params, {
                method: 'POST',
                // Não precisa de headers ou JSON.stringify
            });
            alert(await res.text());
            this.reset();
        });

        document.getElementById('form-detalhar').addEventListener('submit', async function(event) {
            event.preventDefault();
            const id = document.getElementById('idDetalhar').value;
            // GET /produto/:id
            const res = await fetch('/produto/' + id);
            alert(await res.text());
            this.reset();
        });

        document.getElementById('form-remover').addEventListener('submit', async function(event) {
            event.preventDefault();
            const id = document.getElementById('idRemover').value;
            // GET /produto/delete/:id (Note que este deveria ser um DELETE)
            const res = await fetch('/produto/delete/' + id); 
            alert(await res.text());
            this.reset();
        });

        document.getElementById('btn-todos').addEventListener('click', async function() {
            // GET /produto
            const res = await fetch('/produto');
            alert(await res.text());
        });
    </script>
</body>
</html>